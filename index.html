<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IQ Smart Conveyor Calculator</title>
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Tailwind CSS Output (Minified) */
        *,::before,::after{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:Inter,ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";scroll-behavior:smooth}body{margin:0;min-height:100vh;background:radial-gradient(circle,#3b82f6,#ec4899);color:#1f2937;font-family:Inter,sans-serif;overflow-x:hidden}.flex{display:flex}.space-y-4>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1rem * var(--tw-space-y-reverse))}.justify-between{justify-content:space-between}.gap-6{gap:1.5rem}.mt-6{margin-top:1.5rem}.max-w-7xl{max-width:80rem}.mx-auto{margin-left:auto;margin-right:auto}.p-6{padding:1.5rem}.bg-white{background-color:#fff}.text-2xl{font-size:1.5rem;line-height:2rem}.font-bold{font-weight:700}.mb-6{margin-bottom:1.5rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.font-semibold{font-weight:600}.mb-4{margin-bottom:1rem}.w-full{width:100%}.border{border-width:1px;border-color:#d1d5db}.rounded-lg{border-radius:0.5rem}.p-4{padding:1rem}.text-sm{font-size:.875rem;line-height:1.25rem}.font-medium{font-weight:500}.text-gray-600{--tw-text-opacity:1;color:rgb(75 85 99 / var(--tw-text-opacity))}.shadow-inner{box-shadow:inset 0 2px 4px 0 rgba(0,0,0,0.1)}.transition{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-timing-function:cubic-bezier(0.4,0,0.2,1);transition-duration:150ms}.hover\:translate-y-1:hover{--tw-translate-y:0.25rem;transform:translateY(var(--tw-translate-y))}.focus\:border-blue-500:focus{--tw-border-opacity:1;border-color:rgb(59 130 246 / var(--tw-border-opacity))}.focus\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}.focus\:ring-2:focus{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow,0 0 #0000);--tw-ring-opacity:1;--tw-ring-color:rgb(59 130 246 / var(--tw-ring-opacity))}.bg-gray-50{--tw-bg-opacity:1;background-color:rgb(249 250 251 / var(--tw-bg-opacity))}.text-blue-700{--tw-text-opacity:1;color:rgb(29 78 216 / var(--tw-text-opacity))}.text-green-700{--tw-text-opacity:1;color:rgb(21 128 61 / var(--tw-text-opacity))}.text-purple-700{--tw-text-opacity:1;color:rgb(107 33 168 / var(--tw-text-opacity))}.text-yellow-700{--tw-text-opacity:1;color:rgb(161 98 7 / var(--tw-text-opacity))}.text-red-700{--tw-text-opacity:1;color:rgb(185 28 28 / var(--tw-text-opacity))}.text-indigo-700{--tw-text-opacity:1;color:rgb(67 56 202 / var(--tw-text-opacity))}.text-teal-700{--tw-text-opacity:1;color:rgb(15 118 110 / var(--tw-text-opacity))}.text-pink-700{--tw-text-opacity:1;color:rgb(157 23 77 / var(--tw-text-opacity))}.text-orange-700{--tw-text-opacity:1;color:rgb(194 65 12 / var(--tw-text-opacity))}.text-cyan-700{--tw-text-opacity:1;color:rgb(14 116 144 / var(--tw-text-opacity))}.text-lime-700{--tw-text-opacity:1;color:rgb(77 124 15 / var(--tw-text-opacity))}.text-amber-700{--tw-text-opacity:1;color:rgb(146 64 14 / var(--tw-text-opacity))}.text-emerald-700{--tw-text-opacity:1;color:rgb(4 120 87 / var(--tw-text-opacity))}.text-rose-700{--tw-text-opacity:1;color:rgb(159 18 57 / var(--tw-text-opacity))}.text-magenta-700{--tw-text-opacity:1;color:rgb(159 18 141 / var(--tw-text-opacity))}.shadow-md{box-shadow:0 4px 6px -1px rgba(0,0,0,0.1),0 2px 4px -2px rgba(0,0,0,0.1)}.hover\:shadow-lg:hover{box-shadow:0 10px 15px -3px rgba(0,0,0,0.1),0 4px 6px -4px rgba(0,0,0,0.1)}.hover\:scale-105:hover{--tw-scale-x:1.05;--tw-scale-y:1.05;transform:scale(var(--tw-scale-x)) scale(var(--tw-scale-y))}.bg-gradient-to-r{background-image:linear-gradient(to right,var(--tw-gradient-stops))}.from-pink-500{--tw-gradient-from:#ec4899 var(--tw-gradient-from-position);--tw-gradient-to:rgb(236 72 153 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.to-purple-600{--tw-gradient-to:#9333ea var(--tw-gradient-to-position)}.from-cyan-500{--tw-gradient-from:#06b6d4 var(--tw-gradient-from-position);--tw-gradient-to:rgb(6 182 212 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.to-teal-600{--tw-gradient-to:#047857 var(--tw-gradient-to-position)}:root{--primary-color:#db2777;--secondary-color:#7c3aed;--text-color:#1f2937;--background-color:#f1f5f9}.title-page{position:fixed;top:0;left:0;width:100%;height:100vh;display:flex;justify-content:center;align-items:center;background:linear-gradient(45deg,#db2777,#22d3ee,#a78bfa);z-index:1000;transform:translateZ(0);transition:transform .8s ease-in-out}.title-page.hidden{transform:translateY(-100%)}.title-container{text-align:center;perspective:1000px}.title,.subtitle,.teacher{color:#fff;text-shadow:0 4px 6px rgba(0,0,0,0.3);transform:translateZ(20px);transition:transform .5s ease}.title{font-size:4rem;font-weight:800}.subtitle{font-size:2rem;font-weight:600}.teacher{font-size:1.5rem;font-weight:400}@keyframes float{0%,100%{transform:translateZ(20px) translateY(0)}50%{transform:translateZ(40px) translateY(-10px)}}.title-container:hover .title,.title-container:hover .subtitle,.title-container:hover .teacher{animation:float 2s ease-in-out infinite}.continue-btn{position:absolute;bottom:40px;left:50%;transform:translateX(-50%);padding:12px 24px;background:linear-gradient(to right,#f97316,#facc15);color:#fff;border:none;border-radius:12px;cursor:pointer;font-size:1.2rem;font-weight:600;box-shadow:0 8px 20px rgba(0,0,0,0.3);transition:transform .3s ease,box-shadow .3s ease}.continue-btn:hover{transform:translateX(-50%) scale(1.1);box-shadow:0 12px 25px rgba(0,0,0,0.4)}.calculator-page{display:none;min-height:100vh;padding:24px}.calculator-page.visible{display:flex}.calculator-container{display:flex;max-width:1200px;margin:0 auto;gap:24px}.sidebar{width:250px;background:#fff;border-radius:16px;padding:24px;box-shadow:0 8px 30px rgba(0,0,0,0.2);transform:translateZ(10px)}.sidebar h2{font-size:1.5rem;font-weight:700;margin-bottom:16px;color:#db2777}.sidebar ul{list-style:none;padding:0}.sidebar li{margin:8px 0}.sidebar button{width:100%;text-align:left;padding:12px;background:linear-gradient(to right,#e5e7eb,#f3f4f6);border:none;border-radius:8px;font-size:1rem;font-weight:500;cursor:pointer;transition:background .3s ease,transform .3s ease}.sidebar button.active,.sidebar button:hover{background:linear-gradient(to right,#ec4899,#9333ea);color:#fff;transform:translateX(5px)}.content-area{flex:1;background:#fff;border-radius:16px;padding:32px;box-shadow:0 8px 30px rgba(0,0,0,0.2);transform:translateZ(10px)}.content-section{display:none}.content-section.active{display:block;animation:fadeIn .5s ease-in-out}@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.input-group{background:#f9fafb;padding:16px;border-radius:12px;box-shadow:inset 0 2px 4px rgba(0,0,0,0.1);transition:transform .3s ease}.input-group:hover{transform:translateY(-3px)}.input-group label{font-size:.9rem;font-weight:500;color:#4b5563}.input-group input,.input-group select{width:100%;padding:10px;border:1px solid #d1d5db;border-radius:8px;font-size:1rem;transition:border-color .3s ease}.input-group input:focus,.input-group select:focus{border-color:#db2777;outline:none;box-shadow:0 0 0 3px rgba(219,39,119,0.2)}.nav-button,.calculate-btn{padding:12px 24px;border:none;border-radius:12px;font-size:1rem;font-weight:600;cursor:pointer;transition:transform .3s ease,box-shadow .3s ease}.nav-button{background:linear-gradient(to right,#a1a1aa,#d4d4d8);color:#fff}.nav-button:hover{transform:scale(1.05);box-shadow:0 4px 10px rgba(0,0,0,0.2)}.calculate-btn{background:linear-gradient(to right,#06b6d4,#047857);color:#fff}.calculate-btn:hover{transform:scale(1.05);box-shadow:0 4px 10px rgba(0,0,0,0.2)}.result-box{background:#fff;padding:16px;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,0.15);transition:transform .3s ease}.result-box:hover{transform:translateY(-5px)}.chart-container{margin-top:32px;padding:16px;background:#fff;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,0.15)}
    </style>
</head>
<body>
    <!-- Animated Title Page -->
    <div class="title-page" id="titlePage">
        <div class="title-container">
            <h1 class="title">IQ Smart Conveyor Calculator</h1>
            <h2 class="subtitle">By Iqra Arshad</h2>
            <p class="teacher">Supervised by Dr. Badar Hayat</p>
        </div>
        <button class="continue-btn" id="continueBtn">Continue</button>
    </div>

    <!-- Calculator Page -->
    <div class="calculator-page" id="calculatorPage">
        <div class="calculator-container">
            <!-- Sidebar Navigation -->
            <div class="sidebar">
                <h2>IQ Smart Conveyor Calculator</h2>
                <ul>
                    <li><button data-section="material" class="active">Material Properties</button></li>
                    <li><button data-section="conveyor">Conveyor Properties</button></li>
                    <li><button data-section="drive">Drive and Pulley</button></li>
                    <li><button data-section="output">Output Units</button></li>
                </ul>
            </div>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Material Properties -->
                <div class="content-section active" id="material-section">
                    <h2 class="text-2xl font-bold mb-6">Material Properties</h2>
                    <div class="space-y-4">
                        <div class="input-group">
                            <label for="materialType">Material Type</label>
                            <select id="materialType" onchange="toggleCustomDensity()">
                                <option value="55">Coal (55 lb/ft³)</option>
                                <option value="60" selected>Coal (60 lb/ft³)</option>
                                <option value="50">Sand (50 lb/ft³)</option>
                                <option value="45">Grain (45 lb/ft³)</option>
                                <option value="custom">Custom</option>
                            </select>
                        </div>
                        <div id="customDensityDiv" class="input-group hidden">
                            <label for="customDensity">Custom Material Density</label>
                            <div class="flex">
                                <input type="number" id="customDensity" step="any">
                                <select id="customDensityUnit">
                                    <option value="lb/ft3">lb/ft³</option>
                                    <option value="kg/m3">kg/m³</option>
                                </select>
                            </div>
                        </div>
                        <div class="input-group">
                            <label for="capacity">Capacity</label>
                            <div class="flex">
                                <input type="number" id="capacity" step="any" value="1000">
                                <select id="capacityUnit">
                                    <option value="tph">tph</option>
                                    <option value="kg/s">kg/s</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="mt-6 flex justify-between">
                        <button class="nav-button" onclick="showSection('conveyor')">Next</button>
                    </div>
                </div>

                <!-- Conveyor Properties -->
                <div class="content-section" id="conveyor-section">
                    <h2 class="text-2xl font-bold mb-6">Conveyor Properties</h2>
                    <div class="space-y-4">
                        <div class="input-group">
                            <label for="conveyorType">Conveyor Type</label>
                            <select id="conveyorType" onchange="toggleInclinationAngle()">
                                <option value="level">Level</option>
                                <option value="incline" selected>Incline</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="inclinationAngle">Inclination Angle (°)</label>
                            <input type="number" id="inclinationAngle" step="any" value="18">
                        </div>
                        <div class="input-group">
                            <label for="length">Conveyor Length</label>
                            <div class="flex">
                                <input type="number" id="length" step="any" value="1857">
                                <select id="lengthUnit">
                                    <option value="ft">ft</option>
                                    <option value="m">m</option>
                                </select>
                            </div>
                        </div>
                        <div class="input-group">
                            <label for="beltWidth">Belt Width</label>
                            <div class="flex">
                                <input type="number" id="beltWidth" step="any" value="60">
                                <select id="beltWidthUnit">
                                    <option value="in">in</option>
                                    <option value="cm">cm</option>
                                </select>
                            </div>
                        </div>
                        <div class="input-group">
                            <label for="beltSpeed">Belt Speed</label>
                            <div class="flex">
                                <input type="number" id="beltSpeed" step="any" value="700">
                                <select id="beltSpeedUnit">
                                    <option value="fpm">fpm</option>
                                    <option value="m/s">m/s</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="mt-6 flex justify-between">
                        <button class="nav-button" onclick="showSection('material')">Previous</button>
                        <button class="nav-button" onclick="showSection('drive')">Next</button>
                    </div>
                </div>

                <!-- Drive and Pulley -->
                <div class="content-section" id="drive-section">
                    <h2 class="text-2xl font-bold mb-6">Drive and Pulley</h2>
                    <div class="space-y-4">
                        <div class="input-group">
                            <label for="pulleyType">Pulley Type</label>
                            <select id="pulleyType">
                                <option value="lagged" selected>Lagged</option>
                                <option value="bare">Bare</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="arcOfContact">Arc of Contact (°)</label>
                            <input type="number" id="arcOfContact" step="any" value="180">
                        </div>
                        <div class="input-group">
                            <label for="driveEfficiency">Drive Efficiency</label>
                            <input type="number" id="driveEfficiency" step="any" value="0.9">
                        </div>
                        <div class="input-group">
                            <label for="pulleyRPM">Pulley RPM</label>
                            <input type="number" id="pulleyRPM" step="any">
                        </div>
                        <div class="input-group">
                            <label for="takeUpType">Take-Up Type</label>
                            <select id="takeUpType">
                                <option value="manual">Manual</option>
                                <option value="automatic" selected>Automatic</option>
                            </select>
                        </div>
                    </div>
                    <div class="mt-6 flex justify-between">
                        <button class="nav-button" onclick="showSection('conveyor')">Previous</button>
                        <button class="nav-button" onclick="showSection('output')">Next</button>
                    </div>
                </div>

                <!-- Output Units -->
                <div class="content-section" id="output-section">
                    <h2 class="text-2xl font-bold mb-6">Output Units</h2>
                    <div class="space-y-4">
                        <div class="input-group">
                            <label for="outputTensionUnit">Output Tension Unit</label>
                            <select id="outputTensionUnit">
                                <option value="lb">lb</option>
                                <option value="N">N</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="outputPowerUnit">Output Power Unit</label>
                            <select id="outputPowerUnit">
                                <option value="HP">HP</option>
                                <option value="kW">kW</option>
                            </select>
                        </div>
                    </div>
                    <div class="mt-6 flex justify-between">
                        <button class="nav-button" onclick="showSection('drive')">Previous</button>
                        <button class="calculate-btn" onclick="calculateDesign()">Calculate Design</button>
                    </div>
                </div>

                <!-- Results -->
                <div class="content-section" id="results-section">
                    <h2 class="text-2xl font-bold mb-6">Results</h2>
                    <div id="results" class="space-y-4"></div>
                    <div class="chart-container">
                        <h3 class="text-xl font-semibold mb-4">Tension Analysis</h3>
                        <canvas id="tensionChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3 class="text-xl font-semibold mb-4">Power and Idler Metrics</h3>
                        <canvas id="powerIdlerChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Title Page Animation
        const titlePage = document.getElementById('titlePage');
        const calculatorPage = document.getElementById('calculatorPage');
        const continueBtn = document.getElementById('continueBtn');

        continueBtn.addEventListener('click', () => {
            titlePage.classList.add('hidden');
            setTimeout(() => {
                calculatorPage.classList.add('visible');
            }, 800);
        });

        // Sidebar Navigation
        const sections = document.querySelectorAll('.content-section');
        const sidebarButtons = document.querySelectorAll('.sidebar button');

        function showSection(sectionId) {
            sections.forEach(section => {
                section.classList.remove('active');
                if (section.id === ${sectionId}-section) {
                    section.classList.add('active');
                }
            });

            sidebarButtons.forEach(button => {
                button.classList.remove('active');
                if (button.dataset.section === sectionId) {
                    button.classList.add('active');
                }
            });
        }

        sidebarButtons.forEach(button => {
            button.addEventListener('click', () => {
                showSection(button.dataset.section);
            });
        });

        // Calculator Logic
        console.log("Script loaded successfully.");

        // Table 8.3: Maximum Recommended Lump Size
        const maxLumpSize = {
            12: { uniform: 2, mixed: 4 },
            18: { uniform: 4, mixed: 6 },
            24: { uniform: 5, mixed: 8 },
            30: { uniform: 6, mixed: 10 },
            36: { uniform: 7, mixed: 12 },
            42: { uniform: 8, mixed: 14 },
            48: { uniform: 10, mixed: 16 },
            54: { uniform: 11, mixed: 20 },
            60: { uniform: 12, mixed: 24 },
            66: { uniform: 14, mixed: 28 },
            72: { uniform: 16, mixed: 32 }
        };

        // Table 8.4: Maximum Recommended Belt Speeds
        const maxBeltSpeed = {
            14: { coal: 300, sand: 350, grain: 400 },
            16: { coal: 300, sand: 350, grain: 400 },
            18: { coal: 400, sand: 450, grain: 500 },
            20: { coal: 400, sand: 450, grain: 500 },
            24: { coal: 500, sand: 550, grain: 600 },
            30: { coal: 600, sand: 650, grain: 700 },
            36: { coal: 650, sand: 700, grain: 750 },
            42: { coal: 700, sand: 750, grain: 800 },
            48: { coal: 700, sand: 750, grain: 800 },
            54: { coal: 700, sand: 750, grain: 800 },
            60: { coal: 700, sand: 750, grain: 800 },
            66: { coal: 800, sand: 850, grain: 900 },
            72: { coal: 800, sand: 850, grain: 900 }
        };

        // Table 8.5: Capacity at 100 fpm
        const capacityTable = {
            14: { idler20: { 30: 16, 50: 24, 75: 32, 100: 48, 125: 48, 150: 48 },
                  idler35: { 30: 19, 50: 29, 75: 39, 100: 59, 125: 49, 150: 59 },
                  idler30: { 30: 21, 50: 32, 75: 42, 100: 63, 125: 53, 150: 63 } },
            16: { idler20: { 30: 22, 50: 32, 75: 43, 100: 65, 125: 54, 150: 65 },
                  idler35: { 30: 27, 50: 40, 75: 53, 100: 80, 125: 66, 150: 80 },
                  idler30: { 30: 28, 50: 42, 75: 56, 100: 84, 125: 70, 150: 84 } },
            18: { idler20: { 30: 28, 50: 42, 75: 56, 100: 84, 125: 70, 150: 84 },
                  idler35: { 30: 34, 50: 51, 75: 68, 100: 102, 125: 85, 150: 102 },
                  idler30: { 30: 37, 50: 55, 75: 73, 100: 110, 125: 91, 150: 110 } },
            20: { idler20: { 30: 36, 50: 54, 75: 72, 100: 108, 125: 90, 150: 108 },
                  idler35: { 30: 44, 50: 66, 75: 88, 100: 132, 125: 110, 150: 132 },
                  idler30: { 30: 47, 50: 71, 75: 94, 100: 141, 125: 117, 150: 141 } },
            24: { idler20: { 30: 55, 50: 83, 75: 110, 100: 165, 125: 138, 150: 165 },
                  idler35: { 30: 67, 50: 100, 75: 134, 100: 201, 125: 168, 150: 201 },
                  idler30: { 30: 72, 50: 107, 75: 143, 100: 214, 125: 179, 150: 214 } },
            30: { idler20: { 30: 88, 50: 132, 75: 176, 100: 264, 125: 220, 150: 264 },
                  idler35: { 30: 108, 50: 161, 75: 215, 100: 322, 125: 269, 150: 322 },
                  idler30: { 30: 115, 50: 172, 75: 229, 100: 344, 125: 286, 150: 344 } },
            36: { idler20: { 30: 130, 50: 195, 75: 260, 100: 390, 125: 325, 150: 390 },
                  idler35: { 30: 159, 50: 238, 75: 317, 100: 476, 125: 396, 150: 476 },
                  idler30: { 30: 169, 50: 244, 75: 338, 100: 507, 125: 422, 150: 507 } },
            42: { idler20: { 30: 180, 50: 270, 75: 360, 100: 540, 125: 450, 150: 540 },
                  idler35: { 30: 220, 50: 329, 75: 439, 100: 660, 125: 549, 150: 660 },
                  idler30: { 30: 234, 50: 352, 75: 468, 100: 702, 125: 586, 150: 702 } },
            48: { idler20: { 30: 240, 50: 360, 75: 480, 100: 720, 125: 600, 150: 720 },
                  idler35: { 30: 293, 50: 439, 75: 585, 100: 878, 125: 732, 150: 878 },
                  idler30: { 30: 312, 50: 468, 75: 624, 100: 936, 125: 780, 150: 936 } },
            54: { idler20: { 30: 305, 50: 458, 75: 610, 100: 915, 125: 762, 150: 915 },
                  idler35: { 30: 373, 50: 558, 75: 745, 100: 1118, 125: 932, 150: 1118 },
                  idler30: { 30: 397, 50: 595, 75: 793, 100: 1190, 125: 990, 150: 1190 } },
            60: { idler20: { 30: 380, 50: 570, 75: 760, 100: 1140, 125: 950, 150: 1140 },
                  idler35: { 30: 464, 50: 696, 75: 928, 100: 1392, 125: 1160, 150: 1392 },
                  idler30: { 30: 494, 50: 741, 75: 988, 100: 1482, 125: 1235, 150: 1482 } },
            66: { idler20: { 30: 465, 50: 697, 75: 930, 100: 1395, 125: 1163, 150: 1395 },
                  idler35: { 30: 568, 50: 852, 75: 1135, 100: 1703, 125: 1420, 150: 1703 },
                  idler30: { 30: 605, 50: 908, 75: 1210, 100: 1815, 125: 1512, 150: 1815 } },
            72: { idler20: { 30: 557, 50: 837, 75: 1115, 100: 1672, 125: 1395, 150: 1672 },
                  idler35: { 30: 680, 50: 1020, 75: 1360, 100: 2040, 125: 1700, 150: 2040 },
                  idler30: { 30: 725, 50: 1088, 75: 1450, 100: 2175, 125: 1810, 150: 2175 } }
        };

        // Table 8.7: B and Q Values
        const bAndQValues = {
            14: { light: { B: 1, Q: 7 }, medium: { B: 2, Q: 13 }, heavy: { B: 3, Q: 19 } },
            16: { light: { B: 2, Q: 8 }, medium: { B: 3, Q: 14 }, heavy: { B: 4, Q: 21 } },
            18: { light: { B: 3, Q: 9 }, medium: { B: 4, Q: 16 }, heavy: { B: 5, Q: 23 } },
            20: { light: { B: 4, Q: 10 }, medium: { B: 5, Q: 18 }, heavy: { B: 6, Q: 25 } },
            24: { light: { B: 5, Q: 14 }, medium: { B: 6, Q: 21 }, heavy: { B: 7, Q: 29 } },
            30: { light: { B: 6, Q: 19 }, medium: { B: 7, Q: 28 }, heavy: { B: 8, Q: 38 } },
            36: { light: { B: 7, Q: 26 }, medium: { B: 9, Q: 38 }, heavy: { B: 11, Q: 52 } },
            42: { light: { B: 9, Q: 33 }, medium: { B: 11, Q: 50 }, heavy: { B: 14, Q: 66 } },
            48: { light: { B: 12, Q: 40 }, medium: { B: 15, Q: 60 }, heavy: { B: 18, Q: 82 } },
            54: { light: { B: 14, Q: 50 }, medium: { B: 18, Q: 71 }, heavy: { B: 22, Q: 97 } },
            60: { light: { B: 17, Q: 62 }, medium: { B: 21, Q: 85 }, heavy: { B: 27, Q: 115 } },
            66: { light: { B: 20, Q: 75 }, medium: { B: 24, Q: 103 }, heavy: { B: 32, Q: 135 } },
            72: { light: { B: 22, Q: 88 }, medium: { B: 28, Q: 121 }, heavy: { B: 36, Q: 155 } }
        };

        // Table 8.8: K Values
        const kValues = {
            manual: {
                bare: {
                    150: 1.20, 180: 0.97, 190: 0.91, 200: 0.85, 210: 0.80, 220: 0.75, 230: 0.72,
                    240: 0.68, 270: 0.58, 300: 0.51, 330: 0.46, 360: 0.42, 390: 0.39, 420: 0.36,
                    450: 0.33, 480: 0.31
                },
                lagged: {
                    150: 1.00, 180: 0.80, 190: 0.75, 200: 0.71, 210: 0.66, 220: 0.62, 230: 0.59,
                    240: 0.56, 270: 0.49, 300: 0.43, 330: 0.40, 360: 0.36, 390: 0.33, 420: 0.31,
                    450: 0.29, 480: 0.27
                }
            },
            automatic: {
                bare: {
                    150: 0.84, 180: 0.64, 190: 0.59, 200: 0.54, 210: 0.50, 220: 0.46, 230: 0.43,
                    240: 0.40, 270: 0.32, 300: 0.26, 330: 0.22, 360: 0.18, 390: 0.15, 420: 0.13,
                    450: 0.11, 480: 0.09
                },
                lagged: {
                    150: 0.67, 180: 0.50, 190: 0.46, 200: 0.42, 210: 0.38, 220: 0.35, 230: 0.33,
                    240: 0.30, 270: 0.24, 300: 0.19, 330: 0.16, 360: 0.13, 390: 0.11, 420: 0.09,
                    450: 0.07, 480: 0.06
                }
            }
        };

        // Table 8.9: Idler Spacing
        const idlerSpacing = {
            14: { light: 5.5, medium: 5, heavy: 5, return: 10 },
            16: { light: 5.5, medium: 5, heavy: 5, return: 10 },
            18: { light: 5.5, medium: 5, heavy: 5, return: 10 },
            24: { light: 5.5, medium: 4, heavy: 3.5, return: 10 },
            30: { light: 5.5, medium: 4, heavy: 3.5, return: 10 },
            36: { light: 5, medium: 3.5, heavy: 3, return: 10 },
            42: { light: 5, medium: 3.5, heavy: 3, return: 10 },
            48: { light: 4.5, medium: 3.5, heavy: 2.5, return: 10 },
            54: { light: 4.5, medium: 3, heavy: 2.5, return: 10 },
            60: { light: 4.5, medium: 3, heavy: 2.5, return: 9 },
            66: { light: 4.5, medium: 3, heavy: 2.5, return: 9 },
            72: { light: 4.5, medium: 3, heavy: 2.5, return: 9 }
        };

        // Function to interpolate values
        function interpolate(value, x1, x2, y1, y2) {
            return y1 + (value - x1) * (y2 - y1) / (x2 - x1);
        }

        // Function to interpolate K value
        function interpolateKValue(takeUpType, pulleyType, arc) {
            const angles = Object.keys(kValues[takeUpType][pulleyType]).map(Number).sort((a, b) => a - b);
            if (arc <= angles[0]) return kValues[takeUpType][pulleyType][angles[0]];
            if (arc >= angles[angles.length - 1]) return kValues[takeUpType][pulleyType][angles[angles.length - 1]];

            for (let i = 0; i < angles.length - 1; i++) {
                if (arc >= angles[i] && arc <= angles[i + 1]) {
                    const k1 = kValues[takeUpType][pulleyType][angles[i]];
                    const k2 = kValues[takeUpType][pulleyType][angles[i + 1]];
                    return interpolate(arc, angles[i], angles[i + 1], k1, k2);
                }
            }
            return 0.50;
        }

        // Toggle Custom Density Input
        function toggleCustomDensity() {
            const materialType = document.getElementById('materialType').value;
            const customDensityDiv = document.getElementById('customDensityDiv');
            if (materialType === 'custom') {
                customDensityDiv.classList.remove('hidden');
            } else {
                customDensityDiv.classList.add('hidden');
            }
        }

        // Toggle Inclination Angle Input
        function toggleInclinationAngle() {
            const conveyorType = document.getElementById('conveyorType').value;
            const inclinationAngleInput = document.getElementById('inclinationAngle');
            if (conveyorType === 'level') {
                inclinationAngleInput.disabled = true;
                inclinationAngleInput.value = 0;
            } else {
                inclinationAngleInput.disabled = false;
                if (!inclinationAngleInput.value || inclinationAngleInput.value === '0') {
                    inclinationAngleInput.value = 18;
                }
            }
        }

        // Initialize on page load
        window.onload = function() {
            toggleInclinationAngle();
        };

        // Unit Conversion Functions
        function convertLength(value, fromUnit, toUnit) {
            const conversions = {
                'ft': { 'ft': 1, 'm': 0.3048 },
                'm': { 'ft': 3.28084, 'm': 1 }
            };
            return value * conversions[fromUnit][toUnit];
        }

        function convertLengthUnit(value, fromUnit, toUnit) {
            const conversions = {
                'in': { 'in': 1, 'cm': 2.54 },
                'cm': { 'in': 0.393701, 'cm': 1 }
            };
            return value * conversions[fromUnit][toUnit];
        }

        function convertVolumeDensity(value, fromUnit, toUnit) {
            const conversions = {
                'lb/ft3': { 'lb/ft3': 1, 'kg/m3': 16.0185 },
                'kg/m3': { 'lb/ft3': 0.062428, 'kg/m3': 1 }
            };
            return value * conversions[fromUnit][toUnit];
        }

        function convertSpeed(value, fromUnit, toUnit) {
            const conversions = {
                'fpm': { 'fpm': 1, 'm/s': 0.00508 },
                'm/s': { 'fpm': 196.85, 'm/s': 1 }
            };
            return value * conversions[fromUnit][toUnit];
        }

        function convertCapacity(value, fromUnit, toUnit) {
            const conversions = {
                'tph': { 'tph': 1, 'kg/s': (value) => (value * 1000) / 3600 },
                'kg/s': { 'tph': (value) => (value * 3600) / 1000, 'kg/s': 1 }
            };
            return typeof conversions[fromUnit][toUnit] === 'function'
                ? conversions[fromUnit][toUnit](value)
                : value * conversions[fromUnit][toUnit];
        }

        function convertTension(value, fromUnit, toUnit) {
            const conversions = {
                'lb': { 'lb': 1, 'N': 4.44822 },
                'N': { 'lb': 0.224809, 'N': 1 }
            };
            return value * conversions[fromUnit][toUnit];
        }

        function convertPower(value, fromUnit, toUnit) {
            const conversions = {
                'HP': { 'HP': 1, 'kW': 0.7457 },
                'kW': { 'HP': 1.34102, 'kW': 1 }
            };
            return value * conversions[fromUnit][toUnit];
        }

        function calculateDesign() {
            try {
                // Get input values and units
                const materialType = document.getElementById('materialType').value;
                let materialDensity = materialType === 'custom'
                    ? parseFloat(document.getElementById('customDensity').value)
                    : parseFloat(materialType);
                const materialDensityUnit = materialType === 'custom'
                    ? document.getElementById('customDensityUnit').value
                    : 'lb/ft3';
                const capacity = parseFloat(document.getElementById('capacity').value);
                const capacityUnit = document.getElementById('capacityUnit').value;
                const conveyorType = document.getElementById('conveyorType').value;
                const inclinationAngle = parseFloat(document.getElementById('inclinationAngle').value);
                const length = parseFloat(document.getElementById('length').value);
                const lengthUnit = document.getElementById('lengthUnit').value;
                const beltWidth = parseFloat(document.getElementById('beltWidth').value);
                const beltWidthUnit = document.getElementById('beltWidthUnit').value;
                const beltSpeed = parseFloat(document.getElementById('beltSpeed').value);
                const beltSpeedUnit = document.getElementById('beltSpeedUnit').value;
                const pulleyType = document.getElementById('pulleyType').value;
                const arcOfContact = parseFloat(document.getElementById('arcOfContact').value);
                const driveEfficiency = parseFloat(document.getElementById('driveEfficiency').value);
                const pulleyRPM = document.getElementById('pulleyRPM').value ? parseFloat(document.getElementById('pulleyRPM').value) : null;
                const takeUpType = document.getElementById('takeUpType').value;
                const outputTensionUnit = document.getElementById('outputTensionUnit').value;
                const outputPowerUnit = document.getElementById('outputPowerUnit').value;

                // Enhanced Input Validation
                if (!materialType) throw new Error("Material Type is required.");
                if (materialType === 'custom' && (isNaN(materialDensity) || materialDensity <= 0)) {
                    throw new Error("Invalid Custom Material Density: Must be a positive number.");
                }
                if (isNaN(capacity) || capacity <= 0) throw new Error("Invalid Capacity: Must be a positive number.");
                if (isNaN(length) || length <= 0) throw new Error("Invalid Conveyor Length: Must be a positive number.");
                if (isNaN(beltWidth) || beltWidth <= 0) throw new Error("Invalid Belt Width: Must be a positive number.");
                if (isNaN(beltSpeed) || beltSpeed <= 0) throw new Error("Invalid Belt Speed: Must be a positive number.");
                if (isNaN(inclinationAngle)) throw new Error("Invalid Inclination Angle: Must be a number.");
                if (isNaN(arcOfContact) || arcOfContact <= 0 || arcOfContact > 360) {
                    throw new Error("Invalid Arc of Contact: Must be between 0° and 360°.");
                }
                if (isNaN(driveEfficiency)) throw new Error("Invalid Drive Efficiency: Must be a number.");

                if (conveyorType === 'incline' && (inclinationAngle <= 0 || inclinationAngle > 90)) {
                    throw new Error("Inclination angle must be between 0° and 90° for incline conveyors.");
                }
                if (conveyorType === 'level' && inclinationAngle !== 0) {
                    throw new Error("Inclination angle must be 0° for level conveyors.");
                }

                // Handle Drive Efficiency
                let efficiency = driveEfficiency;
                if (driveEfficiency > 0 && driveEfficiency <= 1) {
                    efficiency = driveEfficiency;
                } else if (driveEfficiency > 1 && driveEfficiency <= 100) {
                    efficiency = driveEfficiency / 100;
                } else {
                    throw new Error("Drive Efficiency must be between 0 and 1 (e.g., 0.9) or 0 and 100 (e.g., 90).");
                }

                // Convert inputs to internal units
                const density = convertVolumeDensity(materialDensity, materialDensityUnit, 'lb/ft3');
                const cap = convertCapacity(capacity, capacityUnit, 'tph');
                const len = convertLength(length, lengthUnit, 'ft');
                const width = convertLengthUnit(beltWidth, beltWidthUnit, 'in');
                const speed = convertSpeed(beltSpeed, beltSpeedUnit, 'fpm');

                console.log('Converted Inputs:', { density, cap, len, width, speed });

                // Validate Belt Speed
                const materialKey = materialType === '55' || materialType === '60' ? 'coal' : materialType === '50' ? 'sand' : materialType === '45' ? 'grain' : 'coal';
                const maxSpeed = maxBeltSpeed[width] ? maxBeltSpeed[width][materialKey] : 800;
                if (speed > maxSpeed) {
                    throw new Error(Belt speed (${speed} fpm) exceeds maximum recommended speed (${maxSpeed} fpm) for belt width ${width} in and material ${materialKey}.);
                }

                // Determine material density category
                const densityCategory = density <= 50 ? "light" : (density <= 100 ? "medium" : "heavy");
                const B = bAndQValues[width] ? bAndQValues[width][densityCategory].B : 21;
                const Q = bAndQValues[width] ? bAndQValues[width][densityCategory].Q : 85;

                // Calculate lift
                const inclinationAngleRad = inclinationAngle * Math.PI / 180;
                const lift = Math.round(len * Math.sin(inclinationAngleRad));

                // Friction factor
                const C = 0.022;
                const L0 = 200;

                // Adjusted length
                const adjustedLength = Math.round(len * Math.cos(inclinationAngleRad));

                // Total Empty Conveyor Friction Force
                const emptyFrictionCarrying = C * Q * (adjustedLength / 2);
                const emptyFrictionTotal = C * Q * ((adjustedLength / 2) + L0);
                let totalEmptyFriction = emptyFrictionCarrying + emptyFrictionTotal;

                // Load Friction Force
                let loadFriction = C * (adjustedLength + L0) * (100 * cap) / (3 * speed);

                // Inclined Load Force
                const inclinedLoad = (100 * cap * lift) / (3 * speed);

                // Inclined Belt Force (BH)
                const BH = B * lift;

                // Tight-Side Tension (T1)
                let T1 = totalEmptyFriction + loadFriction + inclinedLoad + BH;

                // Effective Tension (Te)
                let Te = T1 - BH;

                // Slack-Side Tension (T2)
                const K = kValues[takeUpType][pulleyType][arcOfContact] !== undefined
                    ? kValues[takeUpType][pulleyType][arcOfContact]
                    : interpolateKValue(takeUpType, pulleyType, arcOfContact);
                let T2 = Te * K;

                // Takeup Tension
                let takeUpTension = 2 * (T2 - BH);
                if (takeUpTension < 0) {
                    takeUpTension = 0;
                }

                // Tight-Side Tension Excluding BH (T0)
                let T0 = T1 - BH;

                // Maximum Applied Tension (Tmax)
                let maxAppliedTension = T1 + 0.5 * takeUpTension;

                // Horsepower
                let HP = (speed * Te) / (33000 * efficiency);

                // Check for NaN or Infinity
                if (isNaN(HP) || !isFinite(HP) || isNaN(T1) || !isFinite(T1) || isNaN(Te) || !isFinite(Te) || isNaN(T2) || !isFinite(T2)) {
                    throw new Error("Calculation resulted in invalid values. Check input values for correctness.");
                }

                // Standard Horsepower Recommendation
                const standardMotorSizes = [1, 1.5, 2, 3, 5, 7.5, 10, 15, 20, 25, 30, 40, 50, 60, 75, 100, 125, 150, 200, 250, 300, 350, 400, 450, 500, 600, 750, 800, 1000, 1200];
                let recommendedMotorHP = standardMotorSizes.find(size => size >= HP) || 1200;
                const motorConfig = ${recommendedMotorHP} ${outputPowerUnit} motor;

                // Calculate Idler Spacing
                const spacingData = idlerSpacing[width] || { light: 4.5, medium: 3, heavy: 2.5, return: 9 };
                const carryingIdlerSpacing = spacingData[densityCategory];
                const returnIdlerSpacing = spacingData.return;

                // Calculate Number of Idlers
                const numCarryingIdlers = Math.ceil(adjustedLength / carryingIdlerSpacing) + 1;
                const numReturnIdlers = Math.ceil(adjustedLength / returnIdlerSpacing) + 1;

                // Convert results to user's preferred units
                totalEmptyFriction = convertTension(totalEmptyFriction, 'lb', outputTensionUnit);
                loadFriction = convertTension(loadFriction, 'lb', outputTensionUnit);
                Te = convertTension(Te, 'lb', outputTensionUnit);
                T2 = convertTension(T2, 'lb', outputTensionUnit);
                T1 = convertTension(T1, 'lb', outputTensionUnit);
                T0 = convertTension(T0, 'lb', outputTensionUnit);
                takeUpTension = convertTension(takeUpTension, 'lb', outputTensionUnit);
                maxAppliedTension = convertTension(maxAppliedTension, 'lb', outputTensionUnit);
                HP = convertPower(HP, 'HP', outputPowerUnit);

                // Display Results
                const resultsDiv = document.getElementById('results');
                const resultsContent = `
                    <div class="result-box">
                        <h3 class="text-lg font-semibold text-blue-700">Empty Friction Force</h3>
                        <p class="text-2xl font-bold">${totalEmptyFriction.toFixed(0)} ${outputTensionUnit}</p>
                    </div>
                    <div class="result-box">
                        <h3 class="text-lg font-semibold text-green-700">Loaded Friction Force</h3>
                        <p class="text-2xl font-bold">${loadFriction.toFixed(0)} ${outputTensionUnit}</p>
                    </div>
                    <div class="result-box">
                        <h3 class="text-lg font-semibold text-purple-700">Effective Tension (Te)</h3>
                        <p class="text-2xl font-bold">${Te.toFixed(0)} ${outputTensionUnit}</p>
                    </div>
                    <div class="result-box">
                        <h3 class="text-lg font-semibold text-yellow-700">Minimum Slack-Side Tension</h3>
                        <p class="text-2xl font-bold">${T2.toFixed(0)} ${outputTensionUnit}</p>
                    </div>
                    <div class="result-box">
                        <h3 class="text-lg font-semibold text-red-700">Tight-Side Tension (T1)</h3>
                        <p class="text-2xl font-bold">${T1.toFixed(0)} ${outputTensionUnit}</p>
                    </div>
                    <div class="result-box">
                        <h3 class="text-lg font-semibold text-indigo-700">Tight-Side Tension Excluding BH (T0)</h3>
                        <p class="text-2xl font-bold">${T0.toFixed(0)} ${outputTensionUnit}</p>
                    </div>
                    <div class="result-box">
                        <h3 class="text-lg font-semibold text-teal-700">Take-Up Force Required</h3>
                        <p class="text-2xl font-bold">${takeUpTension.toFixed(0)} ${outputTensionUnit}</p>
                    </div>
                    <div class="result-box">
                        <h3 class="text-lg font-semibold text-pink-700">Maximum Applied Tension (Tmax)</h3>
                        <p class="text-2xl font-bold">${maxAppliedTension.toFixed(0)} ${outputTensionUnit}</p>
                    </div>
                    <div class="result-box">
                        <h3 class="text-lg font-semibold text-orange-700">Horsepower</h3>
                        <p class="text-2xl font-bold">${HP.toFixed(0)} ${outputPowerUnit}</p>
                    </div>
                    <div class="result-box">
                        <h3 class="text-lg font-semibold text-cyan-700">Recommended Motor Size</h3>
                        <p class="text-2xl font-bold">${motorConfig}</p>
                    </div>
                    <div class="result-box">
                        <h3 class="text-lg font-semibold text-lime-700">Carrying Idler Spacing</h3>
                        <p class="text-2xl font-bold">${carryingIdlerSpacing.toFixed(1)} ft</p>
                    </div>
                    <div class="result-box">
                        <h3 class="text-lg font-semibold text-amber-700">Number of Carrying Idlers</h3>
                        <p class="text-2xl font-bold">${numCarryingIdlers}</p>
                    </div>
                    <div class="result-box">
                        <h3 class="text-lg font-semibold text-emerald-700">Return Idler Spacing</h3>
                        <p class="text-2xl font-bold">${returnIdlerSpacing.toFixed(1)} ft</p>
                    </div>
                    <div class="result-box">
                        <h3 class="text-lg font-semibold text-magenta-700">Number of Return Idlers</h3>
                        <p class="text-2xl font-bold">${numReturnIdlers}</p>
                    </div>
                `;
                resultsDiv.innerHTML = resultsContent;

                // Show Results Section
                showSection('results');

                // Create Charts
                const tensionChart = new Chart(document.getElementById('tensionChart'), {
                    type: 'bar',
                    data: {
                        labels: ['Empty Friction', 'Loaded Friction', 'Effective (Te)', 'Slack-Side (T2)', 'Tight-Side (T1)', 'T0', 'Take-Up', 'Tmax'],
                        datasets: [{
                            label: Tension (${outputTensionUnit}),
                            data: [totalEmptyFriction, loadFriction, Te, T2, T1, T0, takeUpTension, maxAppliedTension],
                            backgroundColor: [
                                '#3b82f6', '#10b981', '#8b5cf6', '#f59e0b',
                                '#ef4444', '#6366f1', '#14b8a6', '#ec4899'
                            ],
                            borderRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: { display: true, text: Tension (${outputTensionUnit}) }
                            }
                        },
                        plugins: {
                            legend: { display: false },
                            title: { display: true, text: 'Tension Analysis' }
                        }
                    }
                });

                const powerIdlerChart = new Chart(document.getElementById('powerIdlerChart'), {
                    type: 'bar',
                    data: {
                        labels: ['Horsepower', 'Carrying Idlers', 'Return Idlers'],
                        datasets: [{
                            label: 'Metrics',
                            data: [HP, numCarryingIdlers, numReturnIdlers],
                            backgroundColor: ['#f97316', '#22c55e', '#d946ef'],
                            borderRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: { beginAtZero: true, title: { display: true, text: 'Value' } }
                        },
                        plugins: {
                            legend: { display: false },
                            title: { display: true, text: 'Power and Idler Metrics' }
                        }
                    }
                });

                // Scroll to results
                resultsDiv.scrollIntoView({ behavior: 'smooth' });
            } catch (error) {
                console.error('Calculation Error:', error.message, error.stack);
                alert(Error: ${error.message}. Please check your inputs and try again.);
            }
        }

        console.log("calculateDesign function defined.");
    </script>
</body>
</html>
